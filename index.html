<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ—“ï¸ æ¯æ—¥æ‰“å¡</title>
<style>
body{font-family:"Noto Sans TC",sans-serif;background:#f2f5f8;margin:0;padding:20px;color:#222;}
h1{text-align:center;color:#007bff;margin-bottom:10px;}
.card{background:#fff;margin:20px auto;padding:20px;border-radius:8px;box-shadow:0 3px 8px rgba(0,0,0,0.1);max-width:800px;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{padding:8px;text-align:center;border-bottom:1px solid #e0e0e0;}
th{background:#0d6efd;color:white;}
button{border:none;border-radius:6px;padding:8px 12px;font-size:0.95em;cursor:pointer;color:#fff;}
button:hover{opacity:0.9;}
.add-btn{background:#28a745;margin:10px 0;}
.save-btn{background:#0d6efd;}
.clear-btn{background:#6c757d;}
.del-btn{background:#dc3545;}
.progress-container{background:#eee;height:15px;border-radius:8px;overflow:hidden;margin-top:10px;}
.progress-bar{background:linear-gradient(90deg,#fbc02d,#ff9800);height:100%;width:0%;transition:width .4s ease;}
#percentTxt{text-align:center;font-weight:bold;margin-top:5px;}
input[type=time],input[type=text]{padding:4px 6px;border:1px solid #ccc;border-radius:4px;}
.check-cb{transform:scale(1.2);}
.smallnote{color:#666;font-size:0.8em;margin-top:3px;}
</style>
</head>
<body>

<h1>ğŸ“š æ¯æ—¥æ‰“å¡</h1>

<div class="card">

<h2>ğŸ§  ä»Šæ—¥å»ºè­°ç§‘ç›®</h2>
<p>ğŸ’¡ ä¸»ç§‘ï¼š<b id="mainSubject">å°šæœªè¼‰å…¥</b>ã€€ğŸŒ¿ å‰¯ç§‘ï¼š<b id="subSubject">å°šæœªè¼‰å…¥</b></p>
<hr>

<h2>ğŸ•’ ä»Šæ—¥æ™‚æ®µè¨­å®š</h2>
<button class="add-btn" id="addRowBtn">â• æ–°å¢æ™‚æ®µ</button>
<table id="todayTable">
  <thead>
    <tr>
      <th>é–‹å§‹</th>
      <th>çµæŸ</th>
      <th>å…§å®¹</th>
      <th>å®Œæˆ âœ…</th>
      <th>åˆªé™¤</th>
    </tr>
  </thead>
  <tbody>
    <!-- å‹•æ…‹å¡«å…¥ -->
  </tbody>
</table>

<div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
<div id="percentTxt">0%</div>

<div style="margin-top:15px;">
  <button class="save-btn" id="saveBtn">ğŸ’¾ å„²å­˜ä»Šæ—¥ç´€éŒ„</button>
  <button class="clear-btn" id="clearBtn">ğŸ—‘ æ¸…ç©ºå…¨éƒ¨</button>
</div>

</div>

<footer style="text-align:center;color:#777;font-size:0.85em;margin-top:20px;">
Â© 2025 DSE Study Tracker
</footer>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  const tbody=document.querySelector("#todayTable tbody");
  const progressBar=document.getElementById("progressBar");
  const percentTxt=document.getElementById("percentTxt");

  // è¼‰å…¥å»ºè­°ä¸»å‰¯ç§‘
  const suggest=JSON.parse(localStorage.getItem("todaySuggestion")||"{}");
  document.getElementById("mainSubject").textContent=suggest.main||"æœªå®š";
  document.getElementById("subSubject").textContent=suggest.sub||"æœªå®š";

  // è½‰æ›æ™‚é–“å­—ä¸²ç‚ºåˆ†é˜
  function toMin(str){
    const [h,m]=str.split(":").map(Number);
    return h*60+m;
  }

  // è¨ˆç®—åŠ æ¬Šå®Œæˆç‡
  function calcWeightedProgress(){
    const rows=[...tbody.children];
    let total=0,done=0;
    rows.forEach(r=>{
      const start=r.querySelector(".start").value;
      const end=r.querySelector(".end").value;
      if(!start||!end)return;
      const mins=toMin(end)-toMin(start);
      if(mins>0){
        total+=mins;
        if(r.querySelector(".check-cb").checked) done+=mins;
      }
    });
    const percent=total?Math.round((done/total)*100):0;
    progressBar.style.width=percent+"%";
    percentTxt.textContent=percent+"%";
  }

  // æ–°å¢ä¸€åˆ—æ™‚æ®µ
  function addRow(data={}){
    const row=document.createElement("tr");
    row.innerHTML=`
      <td><input type="time" class="start" value="${data.start||''}"></td>
      <td><input type="time" class="end" value="${data.end||''}"></td>
      <td><input type="text" class="subj" placeholder="ç§‘ç›®/å…§å®¹" value="${data.subj||''}"></td>
      <td><input type="checkbox" class="check-cb" ${data.done?'checked':''}></td>
      <td><button class="del-btn">åˆªé™¤</button></td>
    `;
    tbody.appendChild(row);
    // æ¯ç•¶æ™‚é–“/checkboxè®Šå‹• -> æ›´æ–°é€²åº¦
    row.querySelectorAll("input").forEach(el=>el.addEventListener("input",calcWeightedProgress));
    row.querySelector(".del-btn").addEventListener("click",()=>{row.remove();calcWeightedProgress();});
  }

  // å¾å„²å­˜è³‡æ–™è¼‰å…¥
  const savedData=JSON.parse(localStorage.getItem("todayTable")||"[]");
  if(savedData.length){ savedData.forEach(r=>addRow(r)); }
  else{
    // é è¨­åŠ ä¸€å€‹ç¯„ä¾‹æ™‚æ®µ
    addRow({start:"17:00",end:"18:00",subj:"ä¸­æ–‡"});
  }
  calcWeightedProgress();

  // æ–°å¢æ™‚æ®µæŒ‰éˆ•
  document.getElementById("addRowBtn").addEventListener("click",()=>addRow());

  // å„²å­˜åŠŸèƒ½
  document.getElementById("saveBtn").addEventListener("click",()=>{
    const data=[...tbody.children].map(r=>({
      start:r.querySelector(".start").value,
      end:r.querySelector(".end").value,
      subj:r.querySelector(".subj").value,
      done:r.querySelector(".check-cb").checked
    }));
    localStorage.setItem("todayTable",JSON.stringify(data));
    alert("âœ… å·²å„²å­˜ä»Šæ—¥ç´€éŒ„ï¼");
  });

  // æ¸…ç©ºåŠŸèƒ½
  document.getElementById("clearBtn").addEventListener("click",()=>{
    if(confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ™‚æ®µï¼Ÿ")){
      localStorage.removeItem("todayTable");
      tbody.innerHTML="";
      addRow();
      calcWeightedProgress();
    }
  });

});
</script>
</body>
</html>
